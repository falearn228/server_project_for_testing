### Оглавление

1. [**Общие понятия QoS:**](#1-общие-понятия-qos:)
    
    - Что такое QoS и зачем он нужен?
    - Какие параметры влияют на качество обслуживания в сетях
2. **Модели обеспечения QoS:**
    
    - Best Effort (лучшая попытка)
    - Integrated Services (IntServ)
    - Differentiated Services (DiffServ)
3. **Механизмы DiffServ:**
    
    - Маркировка и классификация трафика
    - Как работают механизмы классификации, например, ACL (Access Control List)
    - PHB (Per-Hop Behavior) и типы обслуживания (EF, AF, BE)
4. **Очереди и управление трафиком:**
    
    - Очереди FIFO, PQ, FQ, RR
    - Различия между алгоритмами очередей и их применение на практике
    - Сравнение простоты реализации и эффективности различных алгоритмов
    - Итог по механизмам диспетчеризации: где и как используются
5. **Предотвращение и управление перегрузками:**
    
    - RED (Random Early Detection) и WRED (Weighted RED)
    - Tail Drop
    - Политики управления перегрузками: что лучше для разных сценариев
6. **Ограничение скорости и шейпинг:**
    
    - Алгоритмы Traffic Policing и Traffic Shaping
    - Токен-бакет (Token Bucket) и Личный-бакет (Leaky Bucket): различия, примеры применения
    - Настройка шейпинга в сетевых устройствах
7. **Аппаратная и программная реализация QoS:**
    
    - Как современные коммутаторы и маршрутизаторы реализуют QoS на аппаратном уровне
    - Примеры команд настройки QoS для оборудования Cisco, Huawei, MikroTik
	* Ограничения QoS в виртуализированных средах
8. **Ссылки на литературу**

## 1. Общие понятия QoS
### Что такое QoS и зачем он нужен?

**Quality of Service (QoS)** — это совокупность технологий и механизмов, предназначенных для управления и обеспечения определенного уровня качества передачи данных в компьютерных сетях. QoS необходим для удовлетворения требований различных типов трафика, обеспечивая приоритетную обработку важных данных и минимизацию задержек, потерь пакетов и других негативных факторов, влияющих на качество обслуживания.

**Зачем нужен QoS:**

- **Гарантия производительности** для критически важных приложений, таких как голосовая связь (VoIP), видеоконференции и потоковое видео.
- **Управление пропускной способностью** для предотвращения перегрузок сети и обеспечения справедливого распределения ресурсов между пользователями и приложениями.
- **Снижение задержек и джиттера**, что особенно важно для реального времени приложений.
- **Минимизация потерь пакетов**, обеспечивая надежную передачу данных.

### Какие параметры влияют на качество обслуживания в сетях

1. **Задержка (Latency):**
    
    - Время, необходимое для передачи данных от источника к получателю.
    - Важна для приложений реального времени, таких как VoIP и онлайн-игры.
2. **Джиттер (Jitter):**
    
    - Вариабельность задержки между последовательными пакетами данных.
    - Высокий джиттер может вызывать проблемы с воспроизведением аудио и видео.
3. **Потери пакетов (Packet Loss):**
    
    - Процент потерянных пакетов данных при передаче.
    - Критично для приложений, требующих высокой надежности передачи, таких как файлообмен и потоковое видео.
4. **Пропускная способность (Bandwidth):**
    
    - Максимальная скорость передачи данных по сети.
    - Влияет на количество данных, которые могут быть переданы за определенный промежуток времени.

##  2. Модели обеспечения QoS:

### Best Effort (лучшая попытка)

**Best Effort** (или DSCP 0) — это базовая модель передачи данных, при которой сеть пытается доставить пакеты без гарантий по качеству обслуживания. Все пакеты обрабатываются одинаково, без приоритезации или резервирования ресурсов. Эта модель проста в реализации, но не обеспечивает необходимого уровня качества для приложений с высокими требованиями.

**Характеристики Best Effort:**

- Нет гарантии доставки или задержки.
- Используется в большинстве стандартных интернет-соединений.
- Подходит для некритичных приложений, таких как веб-серфинг и электронная почта.

### Integrated Services (IntServ)

**Integrated Services (IntServ)** — это модель QoS, которая предоставляет гарантии по качеству обслуживания для отдельных потоков трафика. IntServ использует резервирование ресурсов и контроль за маршрутом передачи данных.

**Концепция:**

- **Резервирование ресурсов:** Перед началом передачи данных устанавливается резервирование пропускной способности и других ресурсов сети.
- **Потоковая обработка:** Каждый поток данных обрабатывается отдельно с учетом его требований к QoS.

**Архитектура:**

- **Resource Reservation Protocol (RSVP):** Протокол для резервирования ресурсов в сети.
- **Admission Control:** Механизм контроля допуска новых потоков в сеть на основе доступных ресурсов.

**Примеры использования:**

- В корпоративных сетях для обеспечения качества видеоконференций.
- В специализированных сетях, требующих высокой надежности и предсказуемости передачи данных.

### Differentiated Services (DiffServ)

**Differentiated Services (DiffServ)** — это модель QoS, которая разделяет трафик на классы с различными уровнями приоритетности, обеспечивая дифференцированную обработку пакетов.

**Ключевые концепции:**

- **Классификация трафика:** Разделение трафика на классы на основе различных критериев (тип приложения, источник, назначение и т.д.).
- **Маркировка пакетов:** Присвоение пакетам определенных значений в поле DSCP (Differentiated Services Code Point) для обозначения их класса обслуживания.
- **Перех-Хоп Поведение (PHB):** Определяет, как пакеты определенного класса будут обрабатываться на каждом узле сети.

**Классификация пакетов:**

- Пакеты классифицируются по определенным правилам и маркируются соответствующими значениями DSCP для дальнейшей обработки.

**DSCP (Differentiated Services Code Point):**

- 6-битное поле в заголовке IP-пакета, используемое для маркировки пакетов в соответствии с классом обслуживания.

## 3. Механизмы DiffServ:

### Маркировка и классификация трафика

**Маркировка трафика** — процесс присвоения каждому пакету определенного значения DSCP в заголовке IP-пакета. Это значение определяет, к какому классу обслуживания относится пакет и как он будет обрабатываться в сети.

**Классификация трафика** — процесс определения класса обслуживания для каждого пакета на основе определенных критериев, таких как тип приложения, порт назначения, IP-адрес источника и назначения и т.д.

**Процесс:**

1. **Определение правил классификации:** Устанавливаются правила для определения класса трафика.
2. **Применение маркировки:** Пакеты, соответствующие определенным правилам, получают соответствующие значения DSCP.

### Как работают механизмы классификации, например, ACL (Access Control List)

**Access Control List (ACL)** — это список правил, используемых для фильтрации и классификации трафика в сетевых устройствах, таких как маршрутизаторы и коммутаторы.

**Работа ACL:**

1. **Определение критериев:** Устанавливаются критерии для идентификации пакетов, такие как IP-адреса, порты, протоколы и т.д.
2. **Применение правил:** ACL анализирует каждый пакет и определяет, какие правила к нему применяются.
3. **Классификация и маркировка:** В зависимости от совпадения с правилами, пакеты классифицируются и маркируются соответствующими значениями DSCP.

**Пример использования ACL:**

- Классификация VoIP-трафика для обеспечения низкой задержки и высокой приоритетности.
- Классификация видеотрафика для обеспечения достаточной пропускной способности.

### PHB (Per-Hop Behavior) и типы обслуживания (EF, AF, BE)

**Per-Hop Behavior (PHB)** — это набор правил, определяющих, как пакеты определенного класса обслуживания должны обрабатываться на каждом узле сети. PHB обеспечивает согласованную обработку пакетов на каждом участке маршрута.

**Типы обслуживания в DiffServ:**

1. **Expedited Forwarding (EF):**
    
    - **Назначение:** Обеспечивает высокий приоритет и минимальную задержку для критически важных трафиков, таких как VoIP и видеоконференции.
    - **Маркировка DSCP:** Обычно использует значение 46 (101110).
    - **Характеристики:** Гарантированная пропускная способность, низкая задержка и минимальный джиттер.
2. **Assured Forwarding (AF):**
    
    - **Назначение:** Обеспечивает гарантированную доставку для трафика с разными уровнями приоритетности.
    - **Маркировка DSCP:** Использует значения от 10 до 46, разделенные на классы и подклассы (например, AF11, AF21 и т.д.).
    - **Характеристики:** Предоставляет четыре класса приоритетности (AF1x, AF2x, AF3x, AF4x) с тремя уровнями доверия внутри каждого класса (x = 1, 2, 3).
3. **Best Effort (BE):**
    
    - **Назначение:** Обрабатывает трафик без особых гарантий, используется для некритичных приложений.
    - **Маркировка DSCP:** Значение 0 (000000).
    - **Характеристики:** Пакеты обрабатываются с наименьшим приоритетом, без гарантии пропускной способности или задержки.

**Пример применения PHB:**

- На каждом маршрутизаторе пакеты с маркировкой EF получают приоритетную обработку, минимизируются задержки и буферные задержки.
- Пакеты с маркировкой AF обрабатываются в соответствии с их классом и подклассом, обеспечивая более высокий приоритет, чем BE, но ниже, чем EF.
- Пакеты с маркировкой BE обрабатываются в остаточном пропускном канале без гарантий.

### Заключение

QoS является критически важным аспектом управления современными сетями, обеспечивая необходимое качество обслуживания для различных типов трафика. Модели обеспечения QoS, такие как Best Effort, IntServ и DiffServ, предоставляют различные подходы к управлению трафиком и гарантированию качества передачи данных. Механизмы DiffServ, включая маркировку и классификацию трафика, использование ACL и реализацию различных типов обслуживания (EF, AF, BE), позволяют эффективно управлять пропускной способностью и приоритетами, обеспечивая стабильную и надежную работу сети.

## 4. Очереди и управление трафиком:
### Очереди FIFO, PQ, FQ, RR

Инструементы планировки (scheduling) - средства, который определяют, как фрейм или пакет будут выходить из сетевого узла. В любом случае, когда пакеты входят в уст-во быстрее, чем выходят (несоответствие скоростей), то возникает точка переполнения или "узкое место". Очередность - это подход, позволяющий устр-вам, которые имеют буффера, приоритизированным пакетам поступать на выход быстрее, чем другим. Этот подход работает только вслучае переполнения очереди. Буфера очередей представляют собой воронку.

**1. FIFO (First-In, First-Out):**

- **Описание:** Простейший тип очереди, где пакеты обрабатываются в порядке их поступления.
- **Характеристики:**
    - Все пакеты имеют одинаковый приоритет.
    - Нет приоритезации трафика.
    - Простота реализации.
- **Применение:** Используется в сетях, где не требуется дифференциация трафика или в системах с низкой нагрузкой.

**2. PQ (Priority Queueing):**

- **Описание:** Очередь с приоритетами, где пакеты разделяются на несколько приоритетных уровней.
- **Характеристики:**
    - Пакеты с более высоким приоритетом обслуживаются раньше.
    - Возможны задержки для пакетов с низким приоритетом при высокой нагрузке.
    - Ограниченное количество приоритетных уровней.
- **Применение:** Обеспечение приоритета для критически важных приложений, таких как VoIP или управление сетью.

**3. FQ (Fair Queueing):**

- **Описание:** Алгоритм, обеспечивающий справедливое распределение пропускной способности между потоками.
- **Характеристики:**
    - Каждому потоку выделяется равная доля пропускной способности.
    - Минимизация задержек и предотвращение голодания потоков.
    - Более сложная реализация по сравнению с FIFO и PQ.
- **Применение:** Ситуации, требующие равного распределения ресурсов между множеством потоков, например, при обслуживании большого числа пользователей.

**4. RR (Round Robin):**

- **Описание:** Алгоритм, при котором обслуживание пакетов происходит циклично, по одному из каждой очереди.
- **Характеристики:**
    - Обеспечивает равное внимание для всех очередей.
    - Предотвращает голодание любой из очередей.
    - Простота реализации.
- **Применение:** Используется в системах, где требуется справедливое распределение ресурсов между различными классами трафика.

### Различия между алгоритмами очередей и их применение на практике

| Алгоритм | Приоритетизация | Справедливость | Сложность реализации | Применение                                         |
| -------- | --------------- | -------------- | -------------------- | -------------------------------------------------- |
| FIFO     | Нет             | Нет            | Простая              | Низкая нагрузка, некритичный трафик                |
| PQ       | Да              | Частичная      | Средняя              | Приоритетный трафик (VoIP, управление сетью)       |
| FQ       | Частично        | Высокая        | Высокая              | Много пользователей, равное распределение ресурсов |
| RR       | Частично        | Высокая        | Простая              | Справедливое распределение между классами трафика  |

### Сравнение простоты реализации и эффективности различных алгоритмов

- **Простота реализации:**
    
    - **FIFO и RR:** Самые простые в реализации благодаря отсутствию сложных механизмов приоритезации.
    - **PQ:** Средняя сложность из-за необходимости управления приоритетами.
    - **FQ:** Самая высокая сложность из-за необходимости отслеживания и управления множеством потоков.
- **Эффективность:**
    
    - **FIFO:** Низкая эффективность при высоких нагрузках, так как не обеспечивает приоритезации.
    - **PQ:** Высокая эффективность для приоритетного трафика, но может привести к голоданию низкоприоритетных пакетов.
    - **FQ:** Высокая эффективность в обеспечении справедливости и предотвращении голодания.
    - **RR:** Высокая эффективность в справедливом распределении ресурсов между очередями.

### Итог по механизмам диспетчеризации: где и как используются

- **FIFO:** Используется в простых сетевых устройствах и ситуациях с низкой нагрузкой, где нет необходимости в приоритезации трафика.
- **PQ:** Применяется для обеспечения приоритета критически важных приложений, таких как VoIP, управляемые системы и т.д.
- **FQ:** Используется в сетях с большим количеством пользователей или потоков, требующих равного распределения ресурсов.
- **RR:** Применяется в системах, где необходимо справедливое распределение пропускной способности между различными классами трафика без сложной приоритезации.

## 5. Предотвращение и управление перегрузками:

### RED (Random Early Detection) и WRED (Weighted RED)

**1. RED (Random Early Detection):**

- **Описание:** Алгоритм управления перегрузками, который случайным образом отбрасывает пакеты до достижения полной перегрузки очереди.
- **Механизм работы:**
    - При увеличении средней длины очереди выше минимального порога, начинается случайное отброс пакетов с определенной вероятностью.
    - Вероятность увеличивается с ростом загрузки очереди.
- **Преимущества:**
    - Предотвращает глобальные блокировки и уменьшает задержки.
    - Снижает вероятность возникновения сетевых колец перегрузок.


**2. WRED (Weighted RED):**

- **Описание:** Улучшенная версия RED, которая учитывает приоритеты трафика при принятии решений об отбросе пакетов. Не смотря на то, что сбросы осуществляются и случайным образом, статистически, пакеты с меньшим приоритетом сбрасываются более агрессивно при достижении административно заданного порога заполнения очереди. WRED позволяет избежать проблем с массовым сбросом пакетов в хвосте очереди и глобальной синхронизацией TCP.
- **Механизм работы:**
    - Разные классы трафика имеют различные минимальные пороги и вероятности отброса.
    - Позволяет приоритетизировать важный трафик, снижая вероятность его отброса.
- **Преимущества:**
    - Более гибкое управление перегрузками.
    - Поддержка приоритетного трафика.
### Tail Drop

**Описание:**

- **Механизм работы:** Отбрасывает все пакеты, когда очередь полностью заполнена.
- **Характеристики:**
    - Простота реализации.
    - Может привести к глобальным блокировкам и возникновению "Альфа-бомб" (проблемы с синхронизацией).
- **Применение:** Используется в простых сетевых устройствах, где не требуется сложное управление перегрузками.

### Политики управления перегрузками: что лучше для разных сценариев

|Политика|Описание|Преимущества|Недостатки|Применение|
|---|---|---|---|---|
|RED|Случайный ранний отбор пакетов|Предотвращает глобальные блокировки, снижает задержки|Сложность настройки|Сетевые устройства с поддержкой RED, предотвращение перегрузок|
|WRED|Weighted RED с учетом приоритетов трафика|Гибкое управление, поддержка приоритетного трафика|Более высокая сложность настройки|Сети с различными классами трафика, требующие приоритетизации|
|Tail Drop|Отбор пакетов при полной загрузке очереди|Простота реализации|Может привести к глобальным блокировкам и "Альфа-бомбам"|Простейшие сетевые устройства, некритичный трафик|

**Выбор политики:**

- **RED/WRED:** Рекомендуются для сетей с высоким трафиком и необходимостью предотвращения перегрузок, особенно когда требуется поддержка различных классов трафика.
- **Tail Drop:** Подходит для простых сетей или некритичного трафика, где сложное управление перегрузками не требуется.

## 6. Ограничение скорости и шейпинг:

### Алгоритмы Traffic Policing и Traffic Shaping

**1. Traffic Policing:**

- **Описание:** Метод ограничения скорости передачи данных путем контроля поступающего трафика и отброса или пометки пакетов, превышающих установленный лимит.
- **Механизм работы:**
    - Пакеты, превышающие лимит скорости, отбрасываются или маркируются для последующей обработки (например, пониженный приоритет).
- **Преимущества:**
    - Простота реализации.
    - Эффективное ограничение скорости.
- **Недостатки:**
    - Возможны потери пакетов.
    - Не сглаживает пиковые нагрузки.
- **Применение:** Ограничение скорости для пользователей или приложений, контроль за соблюдением соглашений о пропускной способности.

**2. Traffic Shaping:**

- **Описание:** Метод управления трафиком путем регулирования скорости передачи данных, сглаживания пиковых нагрузок и буферизации пакетов.
- **Механизм работы:**
    - Пакеты буферизуются и отправляются согласно установленному профилю скорости.
    - Изменяет временные характеристики трафика, не отбрасывая пакеты.
- **Преимущества:**
    - Сглаживание пиковых нагрузок.
    - Снижение потерь пакетов.
    - Улучшение качества обслуживания.
- **Недостатки:**
    - Более сложная реализация.
    - Требует дополнительной буферизации.
- **Применение:** Управление трафиком для обеспечения качества обслуживания, предотвращение перегрузок в сети.

### Токен-бакет (Token Bucket) и Личный-бакет (Leaky Bucket): различия, примеры применения

**1. Токен-бакет (Token Bucket):**

- **Описание:** Механизм контроля скорости передачи данных, где "токены" добавляются в "бакет" с фиксированной скоростью. Для отправки пакета требуется соответствующее количество токенов.
- **Механизм работы:**
    - Токены накапливаются в бакете до максимального размера.
    - Пакет может быть отправлен, если в бакете достаточно токенов, иначе пакет задерживается или отброшен.
- **Преимущества:**
    - Позволяет выдерживать временные пиковые нагрузки.
    - Гибкость в регулировании скорости.
- **Недостатки:**
    - Сложнее в реализации по сравнению с Leaky Bucket.
- **Применение:** Traffic Policing, ограничение скорости пользователей, QoS для различных классов трафика.

**2. Личный-бакет (Leaky Bucket):**

- **Описание:** Механизм контроля скорости передачи данных, где пакеты отправляются с постоянной скоростью, независимо от поступления трафика.
- **Механизм работы:**
    - Пакеты помещаются в очередь и отправляются с фиксированной скоростью.
    - Если очередь заполнена, новые пакеты отбрасываются.
- **Преимущества:**
    - Простота реализации.
    - Предсказуемая скорость передачи.
- **Недостатки:**
    - Не допускает временных пиков, что может привести к отбросу пакетов.
- **Применение:** Traffic Shaping, сглаживание трафика, обеспечение постоянной скорости передачи данных.

**Сравнение:**

|Механизм|Тип контроля|Гибкость|Потенциальные потери пакетов|Применение|
|---|---|---|---|---|
|Token Bucket|Полный контроль|Высокая|Зависит от реализации|Traffic Policing, QoS|
|Leaky Bucket|Постоянная скорость|Низкая|Высокие при пиковых нагрузках|Traffic Shaping, сглаживание трафика|

### Настройка шейпинга в сетевых устройствах

**Шаги настройки Traffic Shaping:**

1. **Определение требований:**
    
    - Определите целевую скорость передачи данных.
    - Определите профили трафика и приоритеты.
2. **Выбор алгоритма:**
    
    - Выберите между Token Bucket и Leaky Bucket в зависимости от требований.
3. **Конфигурация параметров:**
    
    - **Для Token Bucket:**
        - Установите размер бакета (максимальное количество токенов).
        - Установите скорость добавления токенов.
    - **Для Leaky Bucket:**
        - Установите скорость "просачивания" пакетов.
        - Установите размер очереди.
4. **Применение политики на интерфейсах:**
    
    - Настройте Traffic Shaping на нужных интерфейсах маршрутизаторов или коммутаторов.
        
    - Пример настройки на Cisco:
        
```bash
interface GigabitEthernet0/1
	service-policy output SHAPE_POLICY
```
        
5. **Мониторинг и корректировка:**
    
    - Используйте инструменты мониторинга для отслеживания эффективности шейпинга.
    - Корректируйте параметры при необходимости для оптимизации производительности.

**Пример настройки Traffic Shaping на Cisco:**

```bash
policy-map SHAPE_POLICY
	class CLASS_NAME
	   shape average 1000000 8000 2000
	   
interface GigabitEthernet0/1
	service-policy output SHAPE_POLICY
```
- **Пояснения:**
    - `shape average 1000000 8000 2000` — устанавливает среднюю скорость 1 Мбит/с с burst 8000 байт и порогом 2000 байт.
    - `CLASS_NAME` — класс трафика, которому применяется политика шейпинга.
## 7. Аппаратная и программная реализация QoS:
### Как современные коммутаторы и маршрутизаторы реализуют QoS на аппаратном уровне

Современные коммутаторы и маршрутизаторы используют комбинацию аппаратных и программных средств для эффективной реализации Quality of Service (QoS). Аппаратная реализация QoS обеспечивает высокую производительность и минимальные задержки при обработке больших объемов трафика. Основные аспекты аппаратной реализации QoS включают:

1. **Аппаратные очереди (Hardware Queues):**
    
    - **Описание:** Современные устройства оснащены несколькими аппаратными очередями, каждая из которых может быть настроена для обработки определенного класса трафика.
    - **Функции:**
        - Приоритизация трафика.
        - Разделение трафика на разные уровни обслуживания.
        - Управление буферизацией пакетов.
2. **Специализированные процессоры и ASIC:**
    
    - **ASIC (Application-Specific Integrated Circuits):** Используются для выполнения сложных задач по обработке пакетов, таких как классификация, маркировка и очередность обслуживания.
    - **Процессоры управления:** Отвечают за выполнение программных компонентов QoS, обеспечивая гибкость и адаптивность настроек.
3. **Таблицы маршрутизации и классификации:**
    
    - **TCAM (Ternary Content Addressable Memory):** Используется для быстрого поиска и сопоставления пакетов с правилами QoS.
    - **Фильтрация и маркировка пакетов:** Аппаратные таблицы позволяют быстро классифицировать и маркировать пакеты на основе различных критериев (IP-адрес, порт, протокол и т.д.).
4. **Буферизация и управление памятью:**
    
    - **Буферы:** Аппаратные буферы обеспечивают временное хранение пакетов в случае перегрузки.
    - **Управление буферами:** Алгоритмы управления буферами помогают предотвратить потерю пакетов и минимизировать задержки.

**Преимущества аппаратной реализации QoS:**

- **Высокая производительность:** Способность обрабатывать трафик на скорости аппаратных линий без значительных задержек.
- **Низкие задержки:** Мгновенная обработка пакетов благодаря специализированным аппаратным компонентам.
- **Стабильность:** Аппаратные решения менее подвержены влиянию программных сбоев и обеспечивают более предсказуемое поведение.

**Программная реализация QoS**

Программная реализация QoS предоставляет гибкость в настройке и управлении политиками качества обслуживания. Она включает в себя использование операционных систем сетевых устройств и программных алгоритмов для настройки и мониторинга QoS. Основные аспекты программной реализации QoS:

1. **Конфигурация и управление:**
    
    - Использование командной строки или графических интерфейсов для настройки политик QoS.
    - Определение классов трафика, приоритетов и правил обработки пакетов.
2. **Алгоритмы управления очередями:**
    
    - Реализация различных алгоритмов очередей (FIFO, PQ, FQ, RR и т.д.) для управления порядком обработки пакетов.
    - Настройка параметров алгоритмов для оптимизации производительности и качества обслуживания.
3. **Интеграция с другими сетевыми сервисами:**
    
    - Взаимодействие с ACL (Access Control Lists), VLAN (Virtual Local Area Networks) и другими сервисами для комплексного управления трафиком.
    - Маркировка пакетов и применение политик QoS на различных уровнях сети.
4. **Мониторинг и отчетность:**
    
    - Сбор и анализ статистики по QoS.
    - Отслеживание состояния очередей, пропускной способности и задержек.
    - Генерация отчетов для оценки эффективности настроек QoS и выявления проблем.

**Преимущества программной реализации QoS:**

- **Гибкость:** Возможность быстрой и динамической настройки политик QoS в зависимости от текущих потребностей сети.
- **Масштабируемость:** Легкость в добавлении новых классов трафика и изменении существующих политик.
- **Интеграция:** Возможность интеграции с другими программными компонентами и сервисами для комплексного управления сетью.

### Примеры команд настройки QoS для оборудования Cisco, Huawei, MikroTik

 **Cisco**

На оборудовании Cisco настройка QoS включает несколько этапов: определение классов трафика, создание политик и применение политик к интерфейсам.

**Пример настройки DiffServ на маршрутизаторе Cisco:**

1. **Определение классов трафика:**

```bash
configure terminal

class-map match-any VOIP
 match ip dscp ef

class-map match-any VIDEO
 match ip dscp af41
end
```

2. **Создание политики QoS:**

```bash
configure terminal

policy-map QOS_POLICY
 class VOIP
  priority 1000
 class VIDEO
  bandwidth 500
 class class-default
  fair-queue
end
```

3. **Применение политики к интерфейсу:**

```bash
configure terminal

interface GigabitEthernet0/1
 service-policy output QOS_POLICY
end
```

**Пример настройки Traffic Shaping на Cisco:**

```bash
configure terminal

policy-map SHAPE_POLICY
 class CLASS_NAME
  shape average 1000000

interface GigabitEthernet0/1
 service-policy output SHAPE_POLICY
end
```

 **Huawei**

На оборудовании Huawei настройка QoS также включает определение классов трафика, создание политик и применение их к интерфейсам.

**Пример настройки DiffServ на коммутаторе Huawei:**

1. **Определение классификаторов трафика:**

```bash
system-view

traffic classifier VOIP_CLASS
 if-match dscp ef

traffic classifier VIDEO_CLASS
 if-match dscp af41
```

2. **Создание поведения для трафика:**

```bash
traffic behavior VOIP_BEHAVIOR
 priority 1 # Наивысший приоритет для Voice 
 queue-length 100 # Размер очереди 
 car cir 2048 # Ограничение скорости до 2 Мбит/с
```

3. **Создание политики QoS:**

```bash
traffic policy QOS_POLICY
 classifier VOIP_CLASS behavior VOIP_BEHAVIOR
 classifier VIDEO_CLASS behavior VIDEO_BEHAVIOR
```

4. **Применение политики QoS к интерфейсу:**

```bash
interface GigabitEthernet0/1
 traffic-policy TP1 inbound  # Применяем на входящий трафик
 traffic-policy TP1 outbound # Применяем на исходящий трафик
```

**MikroTik**

На оборудовании MikroTik настройка QoS осуществляется через RouterOS, используя очереди и правила фильтрации.

**Пример настройки очередей для приоритетного трафика на MikroTik:**

1. **Маркировка пакетов с помощью mangle:**

```bash
/ip firewall mangle
 add chain=forward protocol=udp dscp=46 action=mark-packet new-packet-mark=VOIP passthrough=yes
 add chain=forward protocol=udp dscp=34 action=mark-packet new-packet-mark=VIDEO passthrough=yes
```

2. **Создание очередей:**

```bash
/queue tree
 add name=VOIP parent=global priority=1 packet-mark=VOIP
 add name=VIDEO parent=global priority=2 packet-mark=VIDEO
 add name=DEFAULT parent=global priority=8
```

3. **Настройка ограничений скорости:**

```bash
/queue simple
 add name=VOIP target=VOIP max-limit=100k/100k
 add name=VIDEO target=VIDEO max-limit=500k/500k
 add name=DEFAULT target=DEFAULT max-limit=1000k/1000k
```

**Примечание:** В MikroTik RouterOS можно использовать различные типы очередей (например, `simple`, `queue tree`) в зависимости от требований к QoS.

### Ограничения QoS в виртуализированных средах (например, SD-WAN)

Виртуализированные среды, такие как SD-WAN (Software-Defined Wide Area Network), представляют собой динамичные и гибкие инфраструктуры, где традиционные механизмы QoS сталкиваются с рядом ограничений и вызовов:

1. **Абстракция сетевых ресурсов:**
    
    - **Описание:** Виртуализированные сети скрывают физическую топологию, что затрудняет точную классификацию и управление трафиком на аппаратном уровне.
    - **Влияние:** QoS должно быть реализовано в программном обеспечении, что может ограничивать производительность и увеличивать задержки.
2. **Динамическая маршрутизация:**
    
    - **Описание:** SD-WAN обеспечивает динамическое изменение маршрутов на основе текущих условий сети, что может вызывать непредсказуемость в применении QoS.
    - **Влияние:** Политики QoS должны быстро адаптироваться к изменяющимся маршрутам и условиям сети, что усложняет их настройку и управление.
3. **Ограниченные аппаратные возможности:**
    
    - **Описание:** Виртуальные маршрутизаторы и коммутаторы могут иметь ограничения по количеству очередей и приоритетов, которые они могут обрабатывать.
    - **Влияние:** Аппаратная реализация QoS может быть ограничена в виртуализированных средах, требуя более интенсивной программной обработки и оптимизации.
4. **Сложности в интеграции с физической сетью:**
    
    - **Описание:** QoS политики в виртуализированных сетях должны согласовываться с QoS на физических устройствах, что может требовать дополнительной конфигурации и управления.
    - **Влияние:** Возможны несоответствия в маркировке пакетов и обработке приоритетов между виртуальными и физическими сетями, что снижает эффективность QoS.
5. **Безопасность и изоляция:**
    
    - **Описание:** Виртуализированные среды часто требуют изоляции трафика между различными виртуальными сетями (VLAN, VRF), что усложняет применение единых политик QoS.
    - **Влияние:** Необходимость обеспечения безопасности может ограничивать возможности управления трафиком и приоритизации.

**Особенности реализации QoS в SD-WAN:**

1. **Централизованное управление:**
    
    - **Описание:** SD-WAN предоставляет централизованный контроль над политиками QoS, что упрощает управление и настройку.
    - **Преимущество:** Политики могут автоматически адаптироваться к изменениям в сети, обеспечивая консистентное качество обслуживания.
2. **Гибкость и адаптивность:**
    
    - **Описание:** Возможность динамической настройки QoS в зависимости от текущих условий сети и требований приложений.
    - **Преимущество:** Поддержка нескольких типов соединений (MPLS, интернет, LTE) с различными характеристиками позволяет гибко управлять трафиком.
3. **Интеграция с облачными сервисами:**
    
    - **Описание:** QoS в SD-WAN может быть интегрирована с облачными сервисами для обеспечения оптимального качества обслуживания в облачных приложениях.
    - **Преимущество:** Использование облачных контроллеров для мониторинга и управления QoS позволяет улучшить качество обслуживания и снизить задержки для облачных приложений.
4. **Использование виртуальных функций:**
    
    - **Описание:** В SD-WAN QoS реализуется через виртуальные функции (VNFs), что позволяет гибко настраивать и масштабировать политики.
    - **Преимущество:** Легкость в обновлении и масштабировании политик QoS без необходимости физического вмешательства в сеть.

**Ограничения и вызовы:**

1. **Производительность и задержки:**
    
    - Виртуализированные среды могут добавлять дополнительную обработку пакетов, что увеличивает задержки и снижает производительность QoS.
2. **Сложность управления:**
    
    - Управление QoS в SD-WAN требует высокой степени автоматизации и интеграции с другими сетевыми сервисами, что может усложнять конфигурацию и мониторинг.
3. **Совместимость и стандартизация:**
    
    - Различные реализации SD-WAN могут использовать разные подходы к QoS, что затрудняет совместимость и стандартизацию политик QoS.


## 8. Ссылки на литературу:

1. [Как использовать QoS (Quality of Service) для обеспечения качества доступа в интернет.](https://vasexperts.ru/blog/qos/kak-ispolzovat-qos/)
2. [Качество обслуживания в операторских сетях.](https://www.opennet.ru/docs/RUS/qos_oper/)
3. [Quality of Service (QoS) Configuration Guide, Cisco IOS XE Everest 16.6.x (Catalyst 9400 Switches).](https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9400/software/release/16-6/configuration_guide/qos/b_166_qos_9400_cg/b_166_qos_9400_cg_chapter_01.html)
4. [Quality of Service - RouterOS - MikroTik Documentation.](https://help.mikrotik.com/docs/spaces/ROS/pages/189497483/Quality+of+Service)
5. [Руководство по настройке CloudEngine 8800, 7800, 6800 и 5800 V200R005C10 — QoS.](https://support.huawei.com/enterprise/en/doc/EDOC1100074763/c7766195/example-for-configuring-priority-mapping#EN-US_TASK_0141112371)
6. [Показатели и модели реализации качества обслуживания.](https://moluch.ru/archive/124/34328/)
7. [Example for Configuring Traffic Shaping (Using DiffServ Domain-Based Priority Mapping).](https://support.huawei.com/enterprise/en/doc/EDOC1000069520/9d013ccc/example-for-configuring-traffic-shaping-using-diffserv-domain-based-priority-mapping)
8. [Traffic Policing and Traffic Shaping Commands - Huawei.](https://support.huawei.com/enterprise/en/doc/EDOC1100137933/357a9a37/traffic-policing-and-traffic-shaping-commands)
